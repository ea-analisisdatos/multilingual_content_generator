# Archivo: tests/test_dalle_generator.py

# Importamos las bibliotecas necesarias
import pytest
from multilingual_content_generator.services.dalle_generator import generate_dalle_image

# Prueba para la generación de imágenes con DALL-E
def test_generate_dalle_image(monkeypatch):
    """
    Prueba unitaria para la función generate_dalle_image.
    Verifica que la función devuelva una imagen generada a partir de un texto.
    """

    # Mock de respuesta simulada del modelo DALL-E
    def mock_pipeline(*args, **kwargs):
        def mock_call(prompt):
            return [{"images": ["https://dalle.fake/image.jpg"]}]
        return mock_call

    # Aplicamos el mock al pipeline de transformers
    monkeypatch.setattr("transformers.pipeline", mock_pipeline)

    # Ejecutamos la función con un prompt de prueba
    prompt = "Un paisaje de montañas al atardecer"
    result = generate_dalle_image(prompt)

    # Verificamos que el resultado sea una URL de imagen válida
    assert result == "https://dalle.fake/image.jpg", "La función no devolvió la URL esperada."
